---
import Layout from '../layouts/Layout.astro';
import { authService } from '../auth/authService';

let errorMessage = '';

if (Astro.request.method === 'POST') {
    try {
        const formData = await Astro.request.formData();
        const email = formData.get('email')?.toString() || '';
        const password = formData.get('password')?.toString() || '';

        await authService.login({ identity: email, password });
        // Redirect to home page or a protected page on successful login
        return Astro.redirect('/');
    } catch (error: any) {
        errorMessage = error.message || 'Login failed.';
    }
}
---

<Layout title="Login">
    <div class="flex items-center justify-center min-h-screen bg-base-200">
        <div class="card w-full max-w-sm shadow-2xl bg-base-100">
            <div class="card-body">
                <h1 class="text-2xl font-bold text-center">Login</h1>

                {errorMessage && <p class="text-error text-center">{errorMessage}</p>}

                <form method="POST" class="form-control">
                    <div class="form-control">
                        <label class="label" for="email">
                            <span class="label-text">Email:</span>
                        </label>
                        <input type="email" id="email" name="email" class="input input-bordered" required>
                    </div>
                    <div class="form-control">
                        <label class="label" for="password">
                            <span class="label-text">Password:</span>
                        </label>
                        <input type="password" id="password" name="password" class="input input-bordered" required>
                    </div>
                    <div class="form-control mt-6">
                        <button type="submit" class="btn btn-primary">Login</button>
                    </div>
                </form>

                <p class="text-center mt-4">Don't have an account? <a href="/register" class="link link-primary">Register here</a>.</p>
            </div>
        </div>
    </div>
</Layout>