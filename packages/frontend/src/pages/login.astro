---
import Layout from '../layouts/Layout.astro';
import { authService } from '../auth/authService';

let errorMessage = '';

if (Astro.request.method === 'POST') {
    try {
        const formData = await Astro.request.formData();
        const email = formData.get('email')?.toString() || '';
        const password = formData.get('password')?.toString() || '';

        await authService.login({ identity: email, password });
        // Redirect to home page or a protected page on successful login
        return Astro.redirect('/');
    } catch (error: any) {
        errorMessage = error.message || 'Login failed.';
    }
}
---

<Layout title="Login">
    <h1>Login</h1>

    {errorMessage && <p style="color: red;">{errorMessage}</p>}

    <form method="POST">
        <div>
            <label for="email">Email:</label>
            <input type="email" id="email" name="email" required>
        </div>
        <div>
            <label for="password">Password:</label>
            <input type="password" id="password" name="password" required>
        </div>
        <button type="submit">Login</button>
    </form>

    <p>Don't have an account? <a href="/register">Register here</a>.</p>
</Layout>